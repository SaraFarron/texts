# Установка модулей CPAN в домашний каталог

*Некоторые тексты в интернете имеют свойство пропадать со временем. Особенно обидно бывает, если ты несколько лет использовал какую-нибудь документацию, злоупотреблял копипастом, а в один отличный день заходишь на сайт и получаешь в ответ надпись: "404 Not Found".*

*Во избежание этого печального события, копирую одну статью к себе в блог. Кстати, статья распространяется под самой лучшей лицензией в мире - WTFPL - обязательно прочитайте <a href="http://sam.zoy.org/wtfpl/">ее текст</a>.*

### Настройка консоли для работы с локальными модулями

Для того, чтобы интерпретатор Perl, вызванный из консоли, "видел" установленные локально библиотеки, добавьте в файл <font color="#00aa00">.profile</font> следующие строки:

<pre>
PERL5LIB=$HOME:$HOME/lib:$HOME/lib/perl5
export PERL5LIB

MANPATH=$HOME/share/man
export MANPATH
</pre>

Это следует сделать ДО установки модулей, во избежании накладок при установке. Не забудьте "перелогиниться" после добавления, чтобы настройки применились.

### Установка с помощью модуля CPAN

Также в состав дистрибутива Perl входит модуль под названием CPAN. Он позволяет автоматизировать операции установки необходимых модулей, включая установку зависимостей. Модуль может работать в ручном и пакетном режиме. Рассмотрим для простоты ручной режим работы. Для интерактивной работы с модулем следует набрать команду:

<pre>perl -MCPAN -e shell</pre>

При первом запуске программа попытается создать конфигурационный файл и будет задавать вопросы. Проблема в том, что при любых ответах итоговый конфигурационный файл, создаваемый обычно в директории <font color="#00aa00">.cpan/CPAN/MyConfig.pm</font> в домашнем каталоге, не готов к использованию для установки модулей локально. В нём нас интересуют нижеследующие строки, которые должны быть заполнены подобным образом:
<pre>
'build_dir' =&gt; qq[$ENV{'HOME'}/.cpan/build],
'cpan_home' =&gt; qq[$ENV{'HOME'}/.cpan],
'histfile' =&gt; qq[$ENV{'HOME'}/.cpan/histfile],
'keep_source_where' =&gt; qq[$ENV{'HOME'}/.cpan/sources],
'makepl_arg' =&gt; qq[INSTALL_BASE=$ENV{'HOME'}],
'mbuildpl_arg' =&gt; qq[--install_base $ENV{'HOME'}],
'prefs_dir' =&gt; qq[$ENV{'HOME'}/.cpan/prefs],
</pre>

Вместо <font color="#00aa00">$ENV{'HOME'}</font> может стоят полный путь до домашнего каталога пользователя, например: <font color="#00aa00">/home/ваш_логин</font>

Убедившись в правильности конфигурации, можно устанавливать модули. Команда

<pre>perl -MCPAN -e shell</pre>

запускает специальную интерактивную оболочку. Установка модулей в ней производится например такой командой:

<pre>force install ИМЯ_МОДУЛЯ</pre>

Ключевое слово <font color="#00aa00">force</font> позволит избежать отказа от установки в случае отрицательных результатов тестов, которые по разным причинам действительно могут быть отрицательными.

### Настройка веб-сервера apache для работы с локальными модулями

В файл <font color="#00aa00">.htaccess</font> в корневом каталоге сайта или в том каталоге,
где будут cgi-скрипты, добавить строку:

<pre>SetEnv PERL5LIB /home/ваш_логин:/home/ваш_логин/lib:/home/ваш_логин/lib/perl5</pre>

### Использование в cron

Для того, чтобы скрипты, запускающиеся по cron, могли иметь доступ к локально установленным библиотекам, в начале crontab-файла следует прописать нужные строки:

<pre>PERL5LIB=/home/ваш_логин:/home/ваш_логин/lib:/home/ваш_логин/lib/perl5</pre>

Обращаем внимание, что переменные типа <font color="#00aa00">$PATH</font> не разбираются в crontab и требуется полностью прописывать все пути.



