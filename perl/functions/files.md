# Работа с файлами в Perl. Примеры

## Работа с данными

### Создание файла, открытие файла, запись в файл

```perl
use strict;

open FILE, '>>file.txt';
print FILE "Холодное сердце согреешь руками\n";
close FILE;
```

Файл можно открыть для чтения, записи в конец файла, перезаписи, чтения/записи. Для этого нужно использовать префиксы:
<ul>
<li><font color="#00aa00">&lt;</font> - режим чтения</li>
<li><font color="#00aa00">&gt;</font> - режим записи. Если файл уже содержал что-то, эти данные будут удалены</li>
<li><font color="#00aa00">&gt;&gt;</font> - режим записи. Запись новых данных будет вестись в конец файла. Старые данные сохраняются</li>
<li><font color="#00aa00">+&lt;</font> - сохраняет содержимое открываемого файла</li>
<li><font color="#00aa00">+&gt;</font> - сначала очищает содержимое открываемого файла</li>
<li><font color="#00aa00">+&gt;&gt;</font> - сохраняет содержимое открываемого файла, запись в файл всегда осуществляется в конец содержимого файла</li>
</ul>

Если префикс не задан, файл по умолчанию будет открыт в режиме чтения.

Если открыть <u>для записи</u> файл, который еще не существует, то при завершении работы будет создан новый файл.

### Чтение данных из файла

```perl
open FILE, 'file.txt';
while (defined (my $file_line = <file>)) {
        print $file_line;
}
close FILE;
```

Чтение из файла осуществляется построчно.

## Манипуляции с файлами

### Как переименовать файл

<pre>rename "file.txt", "file2.txt";</pre>

Функция <font color="#00aa00">rename</font> - переименовывает указанный список файлов. Возвращает 1 в случае успешного переименования, в другом случае - 0.

```perl
my $status = rename "file2.txt", "file.txt";
print "Файл успешно переименован\n" if $status;
```

### Как получить информацию о файле (дата создания и т.п.)

```perl
#!/usr/local/bin/perl

use strict;

my %file_info = ();
($file_info{dev},$file_info{ino},$file_info{mode},$file_info{nlink},
$file_info{uid},$file_info{gid},$file_info{rdev},$file_info{size},$file_info{atime},
$file_info{mtime},$file_info{ctime},$file_info{blksize},
$file_info{blocks}) = stat('file.txt');

my ( $sec, $min, $hour, $mday, $mon, $year, $wday ) = gmtime($file_info{mtime});
$year+=1900; $mon+=1;
print "Время последнего изменения файла: $mday-$mon-$year , $hour:$min\n";

exit;
```

Функция <font color="#00aa00">stat</font> возвращает информацию в списковом контексте, в следующем порядке:
<ul>
<li>dev - Номер устройства в файловой системе</li>
<li>ino - Номер индексного дескриптора</li>
<li>mode - Режим файла (тип и права доступа)</li>
<li>nlink - Количество жестких ссылок на файл (в отсутствии ссылок равно 1)</li>
<li>uid - Числовой идентификатор владельца файла</li>
<li>gid - Числовой идентификатор группы владельца файла</li>
<li>rdev - Идентификатор устройства (только для специальных файлов)</li>
<li>size - Размер файла в байтах</li>
<li>atime - Время последнего обращения к файлу с начала эпохи</li>
<li>mtime - Время последнего изменения файла с начала эпохи</li>
<li>ctime - Время изменения индексного дескриптора с начала эпохи</li>
<li>blksize - Предпочтительный размер блока для операций ввода/вывода</li>
<li>blocks - Фактическое количество выделенных блоков для размещения файла</li>
</ul>

Начало эпохи датируется 1 января 1900 года 0 часов 0 минут.

Таким образом можно, например, проверить дату последнего изменения файла и удалить его.

### Как изменить время последнего обращения к файлу и его модификации

Функция позволяет <font color="#00aa00">utime()</font> изменить время последнего обращения <font color="#00aa00">(atime)</font> и модификации файла <font color="#00aa00">(mtime)</font>.

```perl
my $atime = time; # т.е. текущее время
my $mtime = time;

utime($atime, $mtime, "file.txt", "file2.txt");
```

Функция возвращает число файлов, для которых операция изменения времени прошла успешно.

### Как удалить файл

Функция <font color="#00aa00">unlink</font> удаляет переданный список файлов. Возвращает число успешно удаленных файлов.
<pre>unlink "file2.txt", "file3.txt";</pre>

### Как изменить права доступа к файлам

<pre>chmod 0666, "file.txt";</pre>

Функции <font color="#00aa00">chmod</font> можно передать список файлов, тогда права доступа будут изменены к каждому из них. Функция задает права доступа для владельца файла, группы и для всех остальных пользователей.

<font color="#00aa00">chmod()</font> возвращает число файлов, права доступа к которым были благополучно изменены.

Памятка: чтобы установить права доступа, нужно указать число:
<ul>
<li>1 (- -x) - возможно только выполнение файла</li>
<li>2 (-w-) - возможна только запись в файл</li>
<li>3 (-wx) - только запись в файл и его выполнение</li>
<li>4 (r- -) - только чтение данных из файла</li>
<li>5 (r-x) - только чтение и выполнение файла</li>
<li>6 (rw-) - только чтение и запись в файл</li>
<li>7 (rwx) - полный доступ: возможно чтение, запись в файл и его запуск на выполнение.</li>
</ul>

### Как изменить владельца файла

Чтобы изменить владельца файла, надо знать его <font color="#00aa00">uid</font> и <font color="#00aa00">gid</font>. Ну и кроме того, надо иметь права на выполнение данной команды.

Если нужно изменить владельца сразу нескольким файлам, можно передать ф-ции список файлов.

Узнать <font color="#00aa00">uid</font> и <font color="#00aa00">gid</font> текущего владельца файла можно с помощью ф-ции <font color="#00aa00">stat</font>.

```perl
my $uid = 257;
my $gid = 7;

my $res = chown($uid, $gid, "file.txt", "assa.txt");
print "Число измененных файлов: $res\n";
```

<font color="#00aa00">chown()</font> возвращает число файлов, владелец для которых был благополучно изменен.

## Перемещение и копирование файлов. File::Copy

Модуль <font color="#00aa00">File::Copy</font> предоставляет 2 удобные функции для копирования и перемещения файлов из одного места в другое.

```perl
use File::Copy;

copy("/home/user/file.txt","/home/user/file2.txt") || die "Copy failed: $!";
move("/home/user/file2.txt","/home/user/file3.txt") || die "Move failed: $!";
```

Оба метода позволяют использовать не только имена, но и дескрипторы файлов. Например, так:

```perl
use File::Copy;

open FILE, '>file.txt';
copy ("/home/user/file2.txt", \*FILE) or die "Copy failed: $!";

close FILE;
```
