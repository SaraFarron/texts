# Catalyst::Engine

## Методы

*Примечание: логика работы Catalyst с движками, изменилась, начиная с версии 5.9. В данном случае по большей части рассматривается версия 5.8. Начиная с версии Catalyst 5.9 прекратилась поддержка множества движков, в том числе был удален модуль Catalyst::Engine::HTTP .*

**$self-&gt;finalize_body($c)**

Получает подготовленный $c-&gt;response-&gt;body и пишет данные в буфер, на вывод.

**$self-&gt;finalize_cookies($c)**

Создает объект CGI::Simple::Cookie на основе $c-&gt;res-&gt;cookies, и добавляет cookies в заголовки ответа.

**$self-&gt;finalize_error($c)**

Метод формирует html-страницу для вывода сообщения об ошибке, передает ее объекту Response - $c-&gt;res-&gt;{body}.

Выведет ошибку, если Catalyst находится в режиме отладки (установлен $c-&gt;debug), или сообщение 'please come back later' в другом случае.

Вызывается в модуле Catalyst.pm :

```perl
    my $engine = $c->engine;
    if ( my $code = $engine->can('finalize') ) {
        $engine->$code($c);
    }
    else {

        $c->finalize_uploads;

        # Error
        if ( $#{ $c->error } >= 0 ) {
            $c->finalize_error;
        }
        ...
    }
```

**$self-&gt;finalize_headers($c)**

Абстрактный метод, переопределяется в конкретных движках. Позволяет движкам записать отправить в ответе заголовки.

**$self-&gt;finalize_uploads($c)**

Удаление временных файлов после выполненных загрузок.

**$self-&gt;prepare_body($c)**

Устанавливает Catalyst::Request с использованием HTTP::Body.

**$self-&gt;prepare_body_chunk($c)**

Считывает блок входящих данных и добавляет его в тело запроса.

**prepare_connection($c)**

Абстрактный метод, реализуется в конкретном движке.

**$self-&gt;prepare_path($c)**

Абстрактный метод, реализуется в конкретном движке.

**$self-&gt;prepare_request($c)**

**$self-&gt;prepare_query_parameters($c)**

Обрабатывает строку запроса и извлекает из нее параметры. Добавляет параметры в $c-&gt;request().

**$self-&gt;prepare_read($c)**

Подготовка к чтению входящих данных из сокета.

**$self-&gt;prepare_request(@arguments)**

Заполняет context-объект данными из объекта запроса.

**$self-&gt;prepare_uploads($c)**

Подготавливает загружаемые данные для дальнейшей работы.

**$self-&gt;write($c, $buffer)**

Абстрактный метод, реализуется в движке. Делает запись в буфер клиента.

**$self-&gt;read($c, [$maxlength])**

Читает данные из входящего потока с помощью вызова "$self-&gt;read_chunk".

**$self-&gt;read_chunk($c, \$buffer, $length)**

Метод read_chunk реализуется в конкретном движке. Метод должен выполнять чтение блока данных из входящего потока.

**$self-&gt;run($app, $server)**

Метод должен быть переопределен в конкретном движке. Запускает движок. Создает сокеты, организует процесс приема запросов, их обработки и отправки ответов клиентам.

<i>В Catalyst версии 5.9 работа этого метода уже организована по-другому.</i>

**$self-&gt;unescape_uri($uri)**

Возвращает непреобразованный URI.

**$self-&gt;env**

Хэш содержащий информацию о переменных окружения, включая многие специальные переменные, добавленные сервером, такие как 
SERVER_&#9913;, REMOTE_&#9913;, HTTP_&#9913; и т.д.
