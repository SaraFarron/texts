# Краткое описание Apache::DBI

Одна из проблем обычных cgi-скриптов в том, что они не позволяют поддерживать постоянное соединение с базой данных (БД).

Во время выполнения каждого запроса скрипт создает новое соединение с БД, выполняет некоторую работу и закрывает соединение. Процесс подключения к БД занимает много времени. Обеспечивая постоянное соединение с БД, можно существенно сократить время выполнения скриптов и нагрузку на сервер.

При использовании с mod_perl, <font style="color: #2f6fab;">Apache::DBI</font> позволяет поддерживать соединение с БД в течении всего времени жизни процесса mod_perl. Соответственно, при поступлении нового запроса, процессу нет необходимости устанавливать новое соединение и можно сразу приступать к работе.

Подключение <font style="color: #2f6fab;">Apache::DBI</font>, httpd.conf:

<pre>PerlModule Apache::DBI</pre>

## Модуль DBI и Apache::DBI

Модуль DBI может работать совместно с <font style="color: #2f6fab;">Apache::DBI</font>. При загрузке модуль DBI проверяет значение переменной окружения <font style="color: #2f6fab;">$ENV{MOD_PERL}</font> и был ли уже загружен модуль <font style="color: #2f6fab;">Apache::DBI</font>. Если результат положительный, модуль DBI при каждом вызове <font style="color: #2f6fab;">connect()</font>, отправляет запрос <font style="color: #2f6fab;">Apache::DBI</font>.

Когда <font style="color: #2f6fab;">Apache::DBI</font> получает запрос <font style="color: #2f6fab;">connect()</font>, он проверяет, есть ли у него готовый <font style="color: #2f6fab;">connect()</font> с теми же аргументами. Если есть, то следует проверка на работоспособность текущего соединения с БД, с помощью метода <font style="color: #2f6fab;">ping()</font>. Если проверка прошла успешно, <font style="color: #2f6fab;">Apache::DBI</font> немедленно возвращает данные дескриптору клиента. Если соединение было оборвано, <font style="color: #2f6fab;">Apache::DBI</font> старается установить новое соединение, сохраняет указание на него и возвращает данные пользователю.

Важно отметить, что соединения с БД не разделяются между процессами. Каждый процесс имеет собственный пул соединений.

Если Вы только начинаете использование <font style="color: #2f6fab;">Apache::DBI</font>, нет необходимости удалять из кода вызовы функции <font style="color: #2f6fab;">disconnect()</font>. <font style="color: #2f6fab;">Apache::DBI</font> перегружает данную функцию пустым методом. В результате, при вызове <font style="color: #2f6fab;">disconnect()</font> не выполняется никаких действий.

Для работы с <font style="color: #2f6fab;">Apache::DBI</font> и DBI вообще никаких изменений в скрипты вносить не нужно.

